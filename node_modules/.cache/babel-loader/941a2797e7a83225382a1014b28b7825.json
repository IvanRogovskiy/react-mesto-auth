{"ast":null,"code":"var _jsxFileName = \"/Users/ivanrogovskiy/Documents/tries/yandex/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport '../App.css';\nimport React from \"react\";\nimport '../index.css';\nimport api from '../utils/Api';\nimport { CurrentUserContext } from '../contexts/currentUserContext';\nimport { Switch, Route, withRouter, useHistory } from 'react-router-dom';\nimport PageContainer from './PageContainer';\nimport ProtectedRoute from './ProtectedRoute';\nimport Login from './Login';\nimport Register from \"./Register\";\nimport * as auth from \"../utils/auth\";\nimport Preloader from \"./Preloader\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst App = _ref => {\n  _s();\n\n  let {\n    location,\n    history\n  } = _ref;\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [account, setAccount] = React.useState('');\n  const [isLoggedIn, setIsLoggedIn] = React.useState(false);\n  const [isLoading, setIsLoading] = React.useState(true); // const history = useHistory()\n\n  const [cards, setCards] = React.useState([]);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({\n    isOpened: false,\n    name: \"\",\n    link: \"\"\n  });\n\n  const handleLogin = isLoggedIn => {\n    setIsLoggedIn(isLoggedIn);\n  };\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarPopupOpen(true);\n  };\n\n  const handleEditProfileClick = () => {\n    setIsEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  };\n\n  const closeAllPopups = () => {\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setSelectedCard({ ...selectedCard,\n      isOpened: false\n    });\n  };\n\n  const handleEscPress = e => {\n    if (e.keyCode === 27) {\n      closeAllPopups();\n    }\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard({\n      isOpened: true,\n      name: card.name,\n      link: card.link\n    });\n  };\n\n  const handleUpdateUser = _ref2 => {\n    let {\n      name,\n      about\n    } = _ref2;\n    api.updateUserInfo({\n      name,\n      about\n    }).then(data => setCurrentUser({\n      currentUser,\n      ...data\n    })).catch(err => console.log(err));\n    closeAllPopups();\n  };\n\n  const handleUpdateAvatar = link => {\n    api.updateUserAvatar(link).then(data => setCurrentUser({\n      currentUser,\n      ...data\n    })).catch(err => console.log(err));\n    closeAllPopups();\n  };\n\n  const handlePlaceAdd = _ref3 => {\n    let {\n      name,\n      link\n    } = _ref3;\n    api.addNewCard({\n      name,\n      link\n    }).then(newCard => {\n      setCards([newCard, ...cards]);\n    }).catch(err => console.log(err));\n    closeAllPopups();\n  };\n\n  const handleCardLike = card => {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    debugger;\n\n    if (!isLiked) {\n      api.addLike(card._id).then(newCard => {\n        setCards(state => state.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => console.log(err));\n    } else {\n      api.removeLike(card._id).then(newCard => {\n        setCards(state => state.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => console.log(err));\n    }\n  };\n\n  const handleCardDelete = card => {\n    api.deleteCard(card._id).then(() => {\n      setCards(state => state.filter(c => c._id !== card._id));\n    }).catch(err => console.log(err));\n  };\n\n  const handleTokenCheck = () => {\n    debugger;\n\n    if (localStorage.getItem('jwt')) {\n      const jwt = localStorage.getItem('jwt');\n      auth.checkToken(jwt).then(_ref4 => {\n        let {\n          data\n        } = _ref4;\n        debugger;\n        console.log(data.email);\n        setAccount(data.email);\n        setIsLoggedIn(true);\n        history.push('/');\n        setIsLoading(false);\n      }).catch(err => console.log(err)).finally(() => {\n        setIsLoading(false);\n      });\n    } else {\n      setIsLoading(false);\n    }\n  };\n\n  React.useEffect(() => {\n    api.getMyProfileInfo().then(userData => {\n      console.log(userData);\n      setCurrentUser(userData);\n    }).catch(err => console.log(err));\n  }, []);\n  React.useEffect(() => {\n    api.getUsersCards().then(userCards => {\n      setCards(userCards);\n    }).catch(err => console.log(err));\n  }, []);\n  React.useEffect(() => {\n    const handleEscPress = e => {\n      if (e.key === 'Escape') {\n        closeAllPopups();\n      }\n    };\n\n    window.addEventListener('keydown', handleEscPress);\n    return () => {\n      window.removeEventListener('keydown', handleEscPress);\n    };\n  }, [closeAllPopups]);\n  React.useEffect(handleTokenCheck, [location, history]);\n  console.log('render');\n  return isLoading ? /*#__PURE__*/_jsxDEV(Preloader, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 15\n  }, this) : /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: {\n      currentUser,\n      account,\n      isLoggedIn\n    },\n    children: /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n        component: PageContainer,\n        exact: true,\n        path: \"/\",\n        handleEscPress: handleEscPress,\n        handleEditProfileClick: handleEditProfileClick,\n        handleEditAvatarClick: handleEditAvatarClick,\n        handleAddPlaceClick: handleAddPlaceClick,\n        handleCardClick: handleCardClick,\n        cards: cards,\n        user: currentUser,\n        handleUpdateUser: handleUpdateUser,\n        handleCardLike: handleCardLike,\n        handleCardDelete: handleCardDelete,\n        isAddPlacePopupOpen: isAddPlacePopupOpen,\n        closeAllPopups: closeAllPopups,\n        handlePlaceAdd: handlePlaceAdd,\n        isEditProfilePopupOpen: isEditProfilePopupOpen,\n        isEditAvatarPopupOpen: isEditAvatarPopupOpen,\n        handleUpdateAvatar: handleUpdateAvatar,\n        selectedCard: selectedCard,\n        loggedIn: isLoggedIn\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-in\",\n        children: /*#__PURE__*/_jsxDEV(Login, {\n          onLogin: handleLogin\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-up\",\n        children: /*#__PURE__*/_jsxDEV(Register, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 13\n  }, this);\n};\n\n_s(App, \"h0USVJ9kKB7f90+KHnmOIEqyBZ8=\");\n\n_c = App;\nexport default _c2 = withRouter(App);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"App\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/ivanrogovskiy/Documents/tries/yandex/react-mesto-auth/src/components/App.js"],"names":["React","api","CurrentUserContext","Switch","Route","withRouter","useHistory","PageContainer","ProtectedRoute","Login","Register","auth","Preloader","App","location","history","currentUser","setCurrentUser","useState","account","setAccount","isLoggedIn","setIsLoggedIn","isLoading","setIsLoading","cards","setCards","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","selectedCard","setSelectedCard","isOpened","name","link","handleLogin","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","closeAllPopups","handleEscPress","e","keyCode","handleCardClick","card","handleUpdateUser","about","updateUserInfo","then","data","catch","err","console","log","handleUpdateAvatar","updateUserAvatar","handlePlaceAdd","addNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","addLike","state","map","c","removeLike","handleCardDelete","deleteCard","filter","handleTokenCheck","localStorage","getItem","jwt","checkToken","email","push","finally","useEffect","getMyProfileInfo","userData","getUsersCards","userCards","key","window","addEventListener","removeEventListener"],"mappings":";;;AAAA,OAAO,YAAP;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,cAAP;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,SAASC,kBAAT,QAAmC,gCAAnC;AACA,SAAQC,MAAR,EAAgBC,KAAhB,EAAuBC,UAAvB,EAAmCC,UAAnC,QAAoD,kBAApD;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAO,KAAKC,IAAZ,MAAsB,eAAtB;AACA,OAAOC,SAAP,MAAsB,aAAtB;;;AAEA,MAAMC,GAAG,GAAG,QAAyB;AAAA;;AAAA,MAAxB;AAACC,IAAAA,QAAD;AAAWC,IAAAA;AAAX,GAAwB;AAEjC,QAAM,CAACC,WAAD,EAAcC,cAAd,IAAgCjB,KAAK,CAACkB,QAAN,CAAe,EAAf,CAAtC;AACA,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBpB,KAAK,CAACkB,QAAN,CAAe,EAAf,CAA9B;AACA,QAAM,CAACG,UAAD,EAAaC,aAAb,IAA8BtB,KAAK,CAACkB,QAAN,CAAe,KAAf,CAApC;AACA,QAAM,CAACK,SAAD,EAAYC,YAAZ,IAA4BxB,KAAK,CAACkB,QAAN,CAAe,IAAf,CAAlC,CALiC,CAMjC;;AAEA,QAAM,CAACO,KAAD,EAAQC,QAAR,IAAoB1B,KAAK,CAACkB,QAAN,CAAe,EAAf,CAA1B;AAEA,QAAM,CAACS,sBAAD,EAAyBC,yBAAzB,IAAsD5B,KAAK,CAACkB,QAAN,CAAe,KAAf,CAA5D;AACA,QAAM,CAACW,mBAAD,EAAsBC,sBAAtB,IAAgD9B,KAAK,CAACkB,QAAN,CAAe,KAAf,CAAtD;AACA,QAAM,CAACa,qBAAD,EAAwBC,wBAAxB,IAAoDhC,KAAK,CAACkB,QAAN,CAAe,KAAf,CAA1D;AACA,QAAM,CAACe,YAAD,EAAeC,eAAf,IAAkClC,KAAK,CAACkB,QAAN,CAAe;AACnDiB,IAAAA,QAAQ,EAAE,KADyC;AAEnDC,IAAAA,IAAI,EAAE,EAF6C;AAGnDC,IAAAA,IAAI,EAAE;AAH6C,GAAf,CAAxC;;AAMA,QAAMC,WAAW,GAAIjB,UAAD,IAAgB;AAClCC,IAAAA,aAAa,CAACD,UAAD,CAAb;AACD,GAFD;;AAIA,QAAMkB,qBAAqB,GAAG,MAAM;AAChCP,IAAAA,wBAAwB,CAAC,IAAD,CAAxB;AACH,GAFD;;AAIA,QAAMQ,sBAAsB,GAAG,MAAM;AACjCZ,IAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACH,GAFD;;AAIA,QAAMa,mBAAmB,GAAG,MAAM;AAC9BX,IAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACH,GAFD;;AAIA,QAAMY,cAAc,GAAG,MAAM;AACzBZ,IAAAA,sBAAsB,CAAC,KAAD,CAAtB;AACAE,IAAAA,wBAAwB,CAAC,KAAD,CAAxB;AACAJ,IAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACAM,IAAAA,eAAe,CAAC,EAAC,GAAGD,YAAJ;AAAkBE,MAAAA,QAAQ,EAAE;AAA5B,KAAD,CAAf;AACH,GALD;;AAOA,QAAMQ,cAAc,GAAIC,CAAD,IAAO;AAC5B,QAAIA,CAAC,CAACC,OAAF,KAAc,EAAlB,EAAsB;AAClBH,MAAAA,cAAc;AACjB;AACF,GAJD;;AAMA,QAAMI,eAAe,GAAIC,IAAD,IAAU;AAC9Bb,IAAAA,eAAe,CAAC;AACZC,MAAAA,QAAQ,EAAE,IADE;AAEZC,MAAAA,IAAI,EAAEW,IAAI,CAACX,IAFC;AAGZC,MAAAA,IAAI,EAAEU,IAAI,CAACV;AAHC,KAAD,CAAf;AAKH,GAND;;AAQA,QAAMW,gBAAgB,GAAG,SAAmB;AAAA,QAAlB;AAACZ,MAAAA,IAAD;AAAOa,MAAAA;AAAP,KAAkB;AAC1ChD,IAAAA,GAAG,CAACiD,cAAJ,CAAmB;AAACd,MAAAA,IAAD;AAAOa,MAAAA;AAAP,KAAnB,EACKE,IADL,CACUC,IAAI,IAAInC,cAAc,CAAC;AAACD,MAAAA,WAAD;AAAc,SAAGoC;AAAjB,KAAD,CADhC,EAEKC,KAFL,CAEWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAFlB;AAGAZ,IAAAA,cAAc;AACf,GALD;;AAOA,QAAMe,kBAAkB,GAAIpB,IAAD,IAAU;AACjCpC,IAAAA,GAAG,CAACyD,gBAAJ,CAAqBrB,IAArB,EACKc,IADL,CACUC,IAAI,IAAInC,cAAc,CAAC;AAACD,MAAAA,WAAD;AAAc,SAAGoC;AAAjB,KAAD,CADhC,EAEKC,KAFL,CAEWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAFlB;AAGAZ,IAAAA,cAAc;AACjB,GALD;;AAOA,QAAMiB,cAAc,GAAG,SAAkB;AAAA,QAAjB;AAACvB,MAAAA,IAAD;AAAOC,MAAAA;AAAP,KAAiB;AACrCpC,IAAAA,GAAG,CAAC2D,UAAJ,CAAe;AAACxB,MAAAA,IAAD;AAAOC,MAAAA;AAAP,KAAf,EACKc,IADL,CACUU,OAAO,IAAI;AACbnC,MAAAA,QAAQ,CAAC,CAACmC,OAAD,EAAU,GAAGpC,KAAb,CAAD,CAAR;AACH,KAHL,EAIK4B,KAJL,CAIWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAJlB;AAKAZ,IAAAA,cAAc;AACjB,GAPD;;AASA,QAAMoB,cAAc,GAAIf,IAAD,IAAU;AAC7B,UAAMgB,OAAO,GAAGhB,IAAI,CAACiB,KAAL,CAAWC,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACC,GAAF,KAAUnD,WAAW,CAACmD,GAA3C,CAAhB;AACA;;AACA,QAAI,CAACJ,OAAL,EAAc;AACV9D,MAAAA,GAAG,CAACmE,OAAJ,CAAYrB,IAAI,CAACoB,GAAjB,EACKhB,IADL,CACWU,OAAD,IAAa;AACnBnC,QAAAA,QAAQ,CAAE2C,KAAD,IAAWA,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAOA,CAAC,CAACJ,GAAF,KAAUpB,IAAI,CAACoB,GAAf,GAAqBN,OAArB,GAA+BU,CAAhD,CAAZ,CAAR;AACH,OAHD,EAIKlB,KAJL,CAIWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAJlB;AAKH,KAND,MAMO;AACHrD,MAAAA,GAAG,CAACuE,UAAJ,CAAezB,IAAI,CAACoB,GAApB,EACKhB,IADL,CACWU,OAAD,IAAa;AACfnC,QAAAA,QAAQ,CAAE2C,KAAD,IAAWA,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAOA,CAAC,CAACJ,GAAF,KAAUpB,IAAI,CAACoB,GAAf,GAAqBN,OAArB,GAA+BU,CAAhD,CAAZ,CAAR;AAAwE,OAFhF,EAGKlB,KAHL,CAGWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAHlB;AAIH;AAEJ,GAhBD;;AAkBA,QAAMmB,gBAAgB,GAAI1B,IAAD,IAAU;AAC/B9C,IAAAA,GAAG,CAACyE,UAAJ,CAAe3B,IAAI,CAACoB,GAApB,EACKhB,IADL,CACU,MAAM;AACRzB,MAAAA,QAAQ,CAAE2C,KAAD,IAAWA,KAAK,CAACM,MAAN,CAAcJ,CAAD,IAAOA,CAAC,CAACJ,GAAF,KAAUpB,IAAI,CAACoB,GAAnC,CAAZ,CAAR;AAA6D,KAFrE,EAGKd,KAHL,CAGWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAHlB;AAIH,GALD;;AAOA,QAAMsB,gBAAgB,GAAG,MAAM;AAC3B;;AACF,QAAIC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAJ,EAAiC;AAC7B,YAAMC,GAAG,GAAGF,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAZ;AACAnE,MAAAA,IAAI,CAACqE,UAAL,CAAgBD,GAAhB,EACK5B,IADL,CACU,SAAW;AAAA,YAAV;AAACC,UAAAA;AAAD,SAAU;AACb;AACAG,QAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAI,CAAC6B,KAAjB;AACA7D,QAAAA,UAAU,CAACgC,IAAI,CAAC6B,KAAN,CAAV;AACA3D,QAAAA,aAAa,CAAC,IAAD,CAAb;AACAP,QAAAA,OAAO,CAACmE,IAAR,CAAa,GAAb;AACA1D,QAAAA,YAAY,CAAC,KAAD,CAAZ;AACH,OARL,EASK6B,KATL,CASWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CATlB,EAUK6B,OAVL,CAUa,MAAM;AACX3D,QAAAA,YAAY,CAAC,KAAD,CAAZ;AACH,OAZL;AAaH,KAfD,MAeO;AACHA,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACH;AACF,GApBD;;AAsBAxB,EAAAA,KAAK,CAACoF,SAAN,CAAgB,MAAM;AAClBnF,IAAAA,GAAG,CAACoF,gBAAJ,GACKlC,IADL,CACWmC,QAAD,IAAc;AAChB/B,MAAAA,OAAO,CAACC,GAAR,CAAY8B,QAAZ;AACArE,MAAAA,cAAc,CAACqE,QAAD,CAAd;AACH,KAJL,EAKKjC,KALL,CAKWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CALlB;AAMH,GAPD,EAOG,EAPH;AASAtD,EAAAA,KAAK,CAACoF,SAAN,CAAgB,MAAM;AAClBnF,IAAAA,GAAG,CAACsF,aAAJ,GACKpC,IADL,CACWqC,SAAD,IAAe;AACjB9D,MAAAA,QAAQ,CAAC8D,SAAD,CAAR;AACH,KAHL,EAIKnC,KAJL,CAIWC,GAAG,IAAIC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAJlB;AAKH,GAND,EAMG,EANH;AAQAtD,EAAAA,KAAK,CAACoF,SAAN,CAAgB,MAAM;AAClB,UAAMzC,cAAc,GAAIC,CAAD,IAAO;AAC1B,UAAIA,CAAC,CAAC6C,GAAF,KAAU,QAAd,EAAwB;AACpB/C,QAAAA,cAAc;AACjB;AACJ,KAJD;;AAKAgD,IAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmChD,cAAnC;AACA,WAAO,MAAM;AACT+C,MAAAA,MAAM,CAACE,mBAAP,CAA2B,SAA3B,EAAsCjD,cAAtC;AACH,KAFD;AAGH,GAVD,EAUG,CAACD,cAAD,CAVH;AAYA1C,EAAAA,KAAK,CAACoF,SAAN,CAAgBR,gBAAhB,EAAkC,CAAC9D,QAAD,EAAWC,OAAX,CAAlC;AAEAwC,EAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AAEF,SACIjC,SAAS,gBACD,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA,UADC,gBAGH,QAAC,kBAAD,CAAoB,QAApB;AAA6B,IAAA,KAAK,EAAE;AAACP,MAAAA,WAAD;AAAcG,MAAAA,OAAd;AAAuBE,MAAAA;AAAvB,KAApC;AAAA,2BACI,QAAC,MAAD;AAAA,8BACI,QAAC,cAAD;AACI,QAAA,SAAS,EAAEd,aADf;AAEI,QAAA,KAAK,MAFT;AAGI,QAAA,IAAI,EAAE,GAHV;AAII,QAAA,cAAc,EAAEoC,cAJpB;AAKI,QAAA,sBAAsB,EAAEH,sBAL5B;AAMI,QAAA,qBAAqB,EAAED,qBAN3B;AAOI,QAAA,mBAAmB,EAAEE,mBAPzB;AAQI,QAAA,eAAe,EAAEK,eARrB;AASI,QAAA,KAAK,EAAErB,KATX;AAUI,QAAA,IAAI,EAAET,WAVV;AAWI,QAAA,gBAAgB,EAAEgC,gBAXtB;AAYI,QAAA,cAAc,EAAEc,cAZpB;AAaI,QAAA,gBAAgB,EAAEW,gBAbtB;AAcI,QAAA,mBAAmB,EAAE5C,mBAdzB;AAeI,QAAA,cAAc,EAAEa,cAfpB;AAgBI,QAAA,cAAc,EAAEiB,cAhBpB;AAiBI,QAAA,sBAAsB,EAAEhC,sBAjB5B;AAkBI,QAAA,qBAAqB,EAAEI,qBAlB3B;AAmBI,QAAA,kBAAkB,EAAE0B,kBAnBxB;AAoBI,QAAA,YAAY,EAAExB,YApBlB;AAqBI,QAAA,QAAQ,EAAEZ;AArBd;AAAA;AAAA;AAAA;AAAA,cADJ,eAwBI,QAAC,KAAD;AAAO,QAAA,IAAI,EAAC,UAAZ;AAAA,+BACI,QAAC,KAAD;AAAO,UAAA,OAAO,EAAEiB;AAAhB;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cAxBJ,eA2BI,QAAC,KAAD;AAAO,QAAA,IAAI,EAAC,UAAZ;AAAA,+BACI,QAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cA3BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,UAJV;AAqCD,CApMD;;GAAMzB,G;;KAAAA,G;AAuMN,qBAAeR,UAAU,CAACQ,GAAD,CAAzB","sourcesContent":["import '../App.css';\nimport React from \"react\";\nimport '../index.css'\nimport api from '../utils/Api';\nimport { CurrentUserContext } from '../contexts/currentUserContext';\nimport {Switch, Route, withRouter, useHistory} from 'react-router-dom';\nimport PageContainer from './PageContainer';\nimport ProtectedRoute from './ProtectedRoute';\nimport Login from './Login';\nimport Register from \"./Register\";\nimport * as auth from \"../utils/auth\";\nimport Preloader from \"./Preloader\";\n\nconst App = ({location, history}) => {\n\n    const [currentUser, setCurrentUser] = React.useState({});\n    const [account, setAccount] = React.useState('')\n    const [isLoggedIn, setIsLoggedIn] = React.useState(false);\n    const [isLoading, setIsLoading] = React.useState(true);\n    // const history = useHistory()\n\n    const [cards, setCards] = React.useState([]);\n\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n    const [selectedCard, setSelectedCard] = React.useState({\n        isOpened: false,\n        name: \"\",\n        link: \"\"\n    });\n\n    const handleLogin = (isLoggedIn) => {\n      setIsLoggedIn(isLoggedIn)\n    }\n\n    const handleEditAvatarClick = () => {\n        setIsEditAvatarPopupOpen(true);\n    }\n\n    const handleEditProfileClick = () => {\n        setIsEditProfilePopupOpen(true);\n    }\n\n    const handleAddPlaceClick = () => {\n        setIsAddPlacePopupOpen(true);\n    }\n    \n    const closeAllPopups = () => {\n        setIsAddPlacePopupOpen(false);\n        setIsEditAvatarPopupOpen(false);\n        setIsEditProfilePopupOpen(false);\n        setSelectedCard({...selectedCard, isOpened: false})\n    }\n\n    const handleEscPress = (e) => {\n      if (e.keyCode === 27) {\n          closeAllPopups()\n      }\n    }\n\n    const handleCardClick = (card) => {\n        setSelectedCard({\n            isOpened: true,\n            name: card.name ,\n            link: card.link,\n        })\n    }\n    \n    const handleUpdateUser = ({name, about}) => {\n      api.updateUserInfo({name, about})\n          .then(data => setCurrentUser({currentUser, ...data}))\n          .catch(err => console.log(err))\n      closeAllPopups();\n    }\n\n    const handleUpdateAvatar = (link) => {\n        api.updateUserAvatar(link)\n            .then(data => setCurrentUser({currentUser, ...data}))\n            .catch(err => console.log(err))\n        closeAllPopups();\n    }\n\n    const handlePlaceAdd = ({name, link}) => {\n        api.addNewCard({name, link})\n            .then(newCard => {\n                setCards([newCard, ...cards])\n            })\n            .catch(err => console.log(err))\n        closeAllPopups();\n    }\n\n    const handleCardLike = (card) => {\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        debugger\n        if (!isLiked) {\n            api.addLike(card._id)\n                .then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            })\n                .catch(err => console.log(err));\n        } else {\n            api.removeLike(card._id)\n                .then((newCard) => {\n                    setCards((state) => state.map((c) => c._id === card._id ? newCard : c))})\n                .catch(err => console.log(err))\n        }\n\n    }\n\n    const handleCardDelete = (card) => {\n        api.deleteCard(card._id)\n            .then(() => {\n                setCards((state) => state.filter((c) => c._id !== card._id))})\n            .catch(err => console.log(err))\n    }\n    \n    const handleTokenCheck = () => {\n        debugger;\n      if (localStorage.getItem('jwt')) {\n          const jwt = localStorage.getItem('jwt');\n          auth.checkToken(jwt)\n              .then(({data})=> {\n                  debugger;\n                  console.log(data.email);\n                  setAccount(data.email)\n                  setIsLoggedIn(true);\n                  history.push('/');\n                  setIsLoading(false);\n              })\n              .catch(err => console.log(err))\n              .finally(() => {\n                  setIsLoading(false)\n              })\n      } else {\n          setIsLoading(false)\n      }\n    }\n\n    React.useEffect(() => {\n        api.getMyProfileInfo()\n            .then((userData) => {\n                console.log(userData);\n                setCurrentUser(userData)\n            })\n            .catch(err => console.log(err))\n    }, [])\n\n    React.useEffect(() => {\n        api.getUsersCards()\n            .then((userCards) => {\n                setCards(userCards)\n            })\n            .catch(err => console.log(err))\n    }, [])\n\n    React.useEffect(() => {\n        const handleEscPress = (e) => {\n            if (e.key === 'Escape') {\n                closeAllPopups();\n            }\n        }\n        window.addEventListener('keydown', handleEscPress);\n        return () => {\n            window.removeEventListener('keydown', handleEscPress);\n        }\n    }, [closeAllPopups])\n\n    React.useEffect(handleTokenCheck, [location, history])\n\n    console.log('render')\n\n  return (\n      isLoading\n          ? ( <Preloader/> )\n          :\n          ( <CurrentUserContext.Provider value={{currentUser, account, isLoggedIn}}>\n                <Switch>\n                    <ProtectedRoute\n                        component={PageContainer}\n                        exact\n                        path={\"/\"}\n                        handleEscPress={handleEscPress}\n                        handleEditProfileClick={handleEditProfileClick}\n                        handleEditAvatarClick={handleEditAvatarClick}\n                        handleAddPlaceClick={handleAddPlaceClick}\n                        handleCardClick={handleCardClick}\n                        cards={cards}\n                        user={currentUser}\n                        handleUpdateUser={handleUpdateUser}\n                        handleCardLike={handleCardLike}\n                        handleCardDelete={handleCardDelete}\n                        isAddPlacePopupOpen={isAddPlacePopupOpen}\n                        closeAllPopups={closeAllPopups}\n                        handlePlaceAdd={handlePlaceAdd}\n                        isEditProfilePopupOpen={isEditProfilePopupOpen}\n                        isEditAvatarPopupOpen={isEditAvatarPopupOpen}\n                        handleUpdateAvatar={handleUpdateAvatar}\n                        selectedCard={selectedCard}\n                        loggedIn={isLoggedIn}\n                    />\n                    <Route path=\"/sign-in\">\n                        <Login onLogin={handleLogin}/>\n                    </Route>\n                    <Route path=\"/sign-up\">\n                        <Register/>\n                    </Route>\n                </Switch>\n            </CurrentUserContext.Provider>))\n};\n\n\nexport default withRouter(App);\n\n"]},"metadata":{},"sourceType":"module"}